<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pacman</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
</head>
<body onload="startGame()">
    <canvas id="canvas"></canvas>
<script src="pacman.js"></script>
<script src="vector.js"></script>
<script src="tile.js"></script>
<script src="map.js"></script>


<script>
function startGame() {
        myGameArea.start()
}
var myGameArea = {
    canvas : document.getElementById("canvas"),
    start : function() {
        this.canvas.width = 1280
        this.canvas.height = 480+30
        this.context = this.canvas.getContext("2d")
        this.frameNo = 0
        this.interval = setInterval(updateGameArea, 10)

        window.addEventListener('keydown', function (e) {
            myGameArea.key = e.keyCode
        })
        window.addEventListener('keyup', function (e) {
            myGameArea.key = false
        })
        },
    clear:function() {
        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height)
    },
}
pacman= new pacman()
map=new map()
function score(){
ctx = myGameArea.context;
ctx.font=("30px VT323")
ctx.fillStyle=("White")
ctx.fillText("Score: "+pacman.score, 10,25)
}
function updateGameArea() {

pacman.keypress(myGameArea.key)
myGameArea.clear()
map.drawMap()
score()
tiles=map.tiles
pacman.show()
if (checkPosition())
    pacman.move()
}
function checkPosition(){
    if  ((pacman.pos.x-8)%16==0 && (pacman.pos.y-8-30)%16 == 0){
        positon = new vector((pacman.pos.x-8)/16,(pacman.pos.y-8-30)/16)   
        if ( !tiles[positon.y][positon.x].EATEN){
            tiles[positon.y][positon.x].EATEN=true
            pacman.score++;
        }
        positonToCheck = new vector(positon.x+pacman.turnTo.x, positon.y+pacman.turnTo.y)
        if (tiles[positonToCheck.y][positonToCheck.x].WALL){
            if (tiles[positon.y+pacman.vel.y][positon.x+pacman.vel.x].WALL)
                return false
            else return true
        }
        else{
            
            pacman.vel=pacman.turnTo
            return true
        }
        
        
    } 
    else {
        console.log((pacman.pos.x-8-20)%16);
        return true
    }
}
</script>
</body>

</html>